(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{213:function(e,t,a){"use strict";a.r(t);var s=a(28),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h3",{attrs:{id:"koa2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa2"}},[e._v("#")]),e._v(" Koa2")]),e._v(" "),a("h4",{attrs:{id:"_1-搭建环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-搭建环境"}},[e._v("#")]),e._v(" 1. 搭建环境")]),e._v(" "),a("h6",{attrs:{id:"新建文件夹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建文件夹"}},[e._v("#")]),e._v(" 新建文件夹")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("mkdir  koa2\n")])])]),a("h6",{attrs:{id:"注意不要使用koa-否则你下载不了包。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意不要使用koa-否则你下载不了包。"}},[e._v("#")]),e._v(" 注意不要使用koa  否则你下载不了包。")]),e._v(" "),a("h6",{attrs:{id:"初始化package-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化package-json"}},[e._v("#")]),e._v(" 初始化package.json")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("npm init -y\n")])])]),a("h6",{attrs:{id:"安装生产环境的koa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装生产环境的koa"}},[e._v("#")]),e._v(" 安装生产环境的koa")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("npm install --save koa\n")])])]),a("h4",{attrs:{id:"_2-第一个demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-第一个demo"}},[e._v("#")]),e._v(" 2.第一个demo")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst app = new Koa();\n\napp.use(async(ctx)=>{\n    ctx.body = 'hello koa2'\n})\n\napp.listen(3000);\nconsole.log('server start')\n")])])]),a("h4",{attrs:{id:"_3-koa-的get-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-koa-的get-请求"}},[e._v("#")]),e._v(" 3. koa 的get 请求")]),e._v(" "),a("h6",{attrs:{id:"koa2-中的get获取到的request有俩种，一种是query，另一种是querystring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa2-中的get获取到的request有俩种，一种是query，另一种是querystring"}},[e._v("#")]),e._v(" koa2 中的get获取到的request有俩种，一种是query，另一种是querystring;")]),e._v(" "),a("ul",[a("li",[e._v("query 是一个json对象")]),e._v(" "),a("li",[e._v("querystring 是一个json字符串")])]),e._v(" "),a("h6",{attrs:{id:"获取方式有两种："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取方式有两种："}},[e._v("#")]),e._v(" 获取方式有两种：")]),e._v(" "),a("ul",[a("li",[e._v("通过ctx.request")]),e._v(" "),a("li",[e._v("通过ctx直接获取")])]),e._v(" "),a("blockquote"),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst app = new Koa();\napp.use(async(ctx)=>{\n    let url =ctx.url;\n    //从request中获取GET请求\n    let request =ctx.request;\n    let req_query = request.query;\n    let req_querystring = request.querystring;\n    //从上下文中直接获取\n    let ctx_query = ctx.query;\n    let ctx_querystring = ctx.querystring;\n    ctx.body={\n        url,\n        req_query,\n        req_querystring,\n        ctx_query,\n        ctx_querystring\n    }\n});\napp.listen(3000,()=>{\n    console.log('[demo] server is starting at port 3000');\n});\n")])])]),a("h4",{attrs:{id:"_4-koa的post-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-koa的post-请求"}},[e._v("#")]),e._v(" 4.koa的POST 请求")]),e._v(" "),a("h6",{attrs:{id:"koa2中提供了ctx-method属性，可以轻松的得到请求的类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa2中提供了ctx-method属性，可以轻松的得到请求的类型"}},[e._v("#")]),e._v(" Koa2中提供了ctx.method属性，可以轻松的得到请求的类型")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v('app.use(async (ctx) => {\n    if (ctx.url === \'/\' && ctx.method === \'GET\') {\n        ctx.body = `\n            <html>\n                <form method="POST" action="/">\n                    <p>用户名</p>\n                    <input name="userName"/><br/>\n                    <p>年龄</p>\n                    <input name="age"/><br/>\n                    <button type="submit">提价</button>\n                </form\n            </html\n        `\n    } else if (ctx.url === \'/\' && ctx.method === \'POST\') {\n        ctx.body = "接收到了POST请求！！"\n    } else {\n        ctx.body = "404!!"\n    }\n})\n')])])]),a("h4",{attrs:{id:"_5-使用koa-bodyparser获取request数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-使用koa-bodyparser获取request数据"}},[e._v("#")]),e._v(" 5.使用koa-bodyparser获取request数据")]),e._v(" "),a("h6",{attrs:{id:"首先要下载koa-bodyparser组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#首先要下载koa-bodyparser组件"}},[e._v("#")]),e._v(" 首先要下载koa-bodyparser组件")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("npm install koa-bodyparser --save\n")])])]),a("h6",{attrs:{id:"必须得使用bodyparser才生效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#必须得使用bodyparser才生效"}},[e._v("#")]),e._v(" 必须得使用bodyparser才生效")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const bodyParser = require('koa-bodyparser');\napp.use(bodyParser());\n")])])]),a("h6",{attrs:{id:"使用demo-（ctx-request-body）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用demo-（ctx-request-body）"}},[e._v("#")]),e._v(" 使用demo （ctx.request.body）")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst bodyParser = require('koa-bodyparser');\nconst app = new Koa();\n\napp.use(bodyParser());\n\napp.use(async (ctx) => {\n    if (ctx.url === '/' && ctx.method === 'GET') {\n        ctx.body = `\n            <html>\n                <form method=\"POST\" action=\"/\">\n                    <p>用户名</p>\n                    <input name=\"userName\"/><br/>\n                    <p>年龄</p>\n                    <input name=\"age\"/><br/>\n                    <button type=\"submit\">提价</button>\n                </form\n            </html\n        `\n    } else if (ctx.url === '/' && ctx.method === 'POST') {\n        let bodyQuery = ctx.request.body;\n        ctx.body = bodyQuery;\n    } else {\n        ctx.body = \"404!!\"\n    }\n})\n\napp.listen(3000,()=>{\n    console.log('node start server port 3000')\n})\n")])])]),a("h4",{attrs:{id:"_6-原生路由实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-原生路由实现"}},[e._v("#")]),e._v(" 6.原生路由实现")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("使用 let iconv = require('iconv-lite'); 进行字体的转码\n data = iconv.decode(data, 'utf-8');\n")])])]),a("h6",{attrs:{id:"demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[e._v("#")]),e._v(" Demo")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst fs = require('fs');\nconst iconv = require('iconv-lite');\nconst app = new Koa();\n\nfunction render(page) {\n    return new Promise((resolve, reject) => {\n        let pageUrl = `./page/${page}`;\n        fs.readFile(pageUrl, \"binary\", (err, data) => {\n            if (err) {\n                reject(err)\n            } else {\n                data = iconv.decode(data, 'utf-8');\n                resolve(data);\n            }\n        })\n    })\n}\n\nasync function route(url) {\n    let html = '404.html'\n    switch (url) {\n        case '/':\n            html = 'index.html';\n            break;\n        case '/news':\n            html = 'news.html';\n            break;\n        case '/content':\n            html = 'content.html';\n            break;\n        case '/strange':\n            html = 'strange.html';\n            break;\n        default:\n            break;\n    }\n    let page = await render(html);\n    return page\n}\n\napp.use(async(ctx) => {\n    let url = ctx.request.url;\n    let html = await route(url);\n    ctx.body = html;\n})\n\napp.listen(3000, () => {\n    console.log('node server at port 3000!')\n})\n")])])]),a("h4",{attrs:{id:"_7-koa-router"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-koa-router"}},[e._v("#")]),e._v(" 7.koa-router")]),e._v(" "),a("ul",[a("li",[e._v("koa-router 是生产环境中使用")])]),e._v(" "),a("blockquote",[a("p",[e._v("npm install koa-router --save")])]),e._v(" "),a("ul",[a("li",[e._v("router 使用")])]),e._v(" "),a("blockquote",[a("p",[e._v("const koaRouter = require('router');")])]),e._v(" "),a("blockquote",[a("p",[e._v("const router = new koaRouter();")])]),e._v(" "),a("ul",[a("li",[e._v("配置路由")])]),e._v(" "),a("blockquote",[a("p",[e._v("router.get('/', async(ctx, next) => {\nctx.body = 'Hello World!!!!'\n})")])]),e._v(" "),a("ul",[a("li",[e._v("路由使用")])]),e._v(" "),a("blockquote",[a("p",[e._v("app\n.use(router.routes())\n.use(router.allowedMethods());")])]),e._v(" "),a("h6",{attrs:{id:"demo-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo-2"}},[e._v("#")]),e._v(" Demo")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst koaRouter = require('koa-router');\n\nconst app = new Koa();\nconst router = new koaRouter();\n\nrouter.get('/', async(ctx, next) => {\n    ctx.body = 'Hello World!!!!'\n})\n\napp\n    .use(router.routes())\n    .use(router.allowedMethods());\n\napp.listen(3000, () => {\n    console.log('node server at port 3000')\n})\n")])])]),a("h4",{attrs:{id:"_8-koa-router-的层级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-koa-router-的层级"}},[e._v("#")]),e._v(" 8.koa-router 的层级")]),e._v(" "),a("h6",{attrs:{id:"设置前缀"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置前缀"}},[e._v("#")]),e._v(" 设置前缀")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const router = new Router({\n    prefix:'/jspang'\n})\n")])])]),a("h6",{attrs:{id:"设置多级路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置多级路由"}},[e._v("#")]),e._v(" 设置多级路由")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst koaRouter = require('koa-router');\n\nconst app = new Koa();\n\nlet home = new koaRouter();\nhome.get('/home', async(ctx) => {\n    ctx.body = \"Home home\";\n}).get('/todo', async(ctx) => {\n    ctx.body = 'Home ToDo';\n})\n\nlet page = new koaRouter();\npage.get('/home', async(ctx) => {\n    ctx.body = \"Page home\";\n}).get('/todo', async(ctx) => {\n    ctx.body = 'Page ToDo';\n})\n\nlet router = new koaRouter();\nrouter.use('/index', home.routes(), home.allowedMethods());\nrouter.use('/page', page.routes(), page.allowedMethods());\n\napp.use(router.routes()).use(router.allowedMethods());\n\napp.listen(3000, () => {\n    console.log('node server at port 3000')\n})\n")])])]),a("h4",{attrs:{id:"_9-koa-中使用cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-koa-中使用cookie"}},[e._v("#")]),e._v(" 9.koa 中使用cookie")]),e._v(" "),a("ul",[a("li",[e._v("ctx.cookies.get(name,[optins]):读取上下文请求中的cookie。")]),e._v(" "),a("li",[e._v("ctx.cookies.set(name,value,[options])：在上下文中写入cookie。")])]),e._v(" "),a("h6",{attrs:{id:"写入cookie操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写入cookie操作"}},[e._v("#")]),e._v(" 写入Cookie操作")]),e._v(" "),a("ul",[a("li",[e._v("domain：写入cookie所在的域名")]),e._v(" "),a("li",[e._v("path：写入cookie所在的路径")]),e._v(" "),a("li",[e._v("maxAge：Cookie最大有效时长")]),e._v(" "),a("li",[e._v("expires：cookie失效时间")]),e._v(" "),a("li",[e._v("httpOnly:是否只用http请求中获得")]),e._v(" "),a("li",[e._v("overwirte：是否允许重写")])]),e._v(" "),a("h6",{attrs:{id:"demo-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo-3"}},[e._v("#")]),e._v(" demo")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("const Koa = require('koa');\nconst app = new Koa();\n\napp.use(async(ctx) => {\n    if (ctx.request.url === '/index') {\n        ctx.cookies.set(\n            'name',\n            'yueshuai', {\n                domain: '127.0.0.1', // 写cookie所在的域名\n                path: '/index', // 写cookie所在的路径\n                maxAge: 1000 * 60 * 60 * 24, // cookie有效时长\n                expires: new Date('2018-12-31'), // cookie失效时间\n                httpOnly: false, // 是否只用于http请求中获取\n                overwrite: false // 是否允许重写\n            }\n        )\n        ctx.body = 'cookie set ok';\n    } else {\n        let message = ctx.cookies.get('name');\n        if (message) {\n            ctx.body = ctx.cookies.get('name');\n        } else {\n            ctx.body = \"cookie get none\";\n        }\n    }\n})\n\napp.listen(3000, () => {\n    console.log('node server start at port 3000')\n})\n")])])]),a("h4",{attrs:{id:"_10-koa-static静态资源中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-koa-static静态资源中间件"}},[e._v("#")]),e._v(" 10.koa-static静态资源中间件")]),e._v(" "),a("h6",{attrs:{id:"安装-koa-static"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-koa-static"}},[e._v("#")]),e._v(" 安装 koa-static")]),e._v(" "),a("blockquote",[a("p",[e._v("npm install --save koa-static")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("const Koa = require('koa'),\n    router = require('koa-router'),\n    static = require('koa-static');\n\nlet app = new Koa();\n\napp.use(static(__dirname+'/static'));\n\napp.listen('3000');\n\nconsole.log('服务器启动成功~')\n")])])]),a("h4",{attrs:{id:"_11-中间件处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-中间件处理"}},[e._v("#")]),e._v(" 11.中间件处理")]),e._v(" "),a("h6",{attrs:{id:"应用级中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用级中间件"}},[e._v("#")]),e._v(" 应用级中间件")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("app.use(async (ctx, next)=> {\n    console.log('这个是中间件！！！')\n    await next();\n    console.log('匹配完成后再次执行中间件！！')\n})\n")])])]),a("h6",{attrs:{id:"路由级中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由级中间件"}},[e._v("#")]),e._v(" 路由级中间件")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("router.get('/news', async(ctx,next)=>{\n    console.log('路由级中间件');\n    await next();\n})\nrouter.get('/news', async(ctx)=>{\n    ctx.body = '这是一个新闻！'\n})\n")])])]),a("h5",{attrs:{id:"错误处理中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误处理中间件"}},[e._v("#")]),e._v(" 错误处理中间件")]),e._v(" "),a("p",[a("strong",[e._v("先执行app.use 再匹配路由")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("app.use(async (ctx, next)=>{\n    console.log('这是一个中间件');\n    \n    await next();\n\n    if(ctx.status === 404) {\n        ctx.body = '404 ERROR'\n    }else {\n        console.log(ctx.url)\n    }\n})\n")])])]),a("h4",{attrs:{id:"_11-ejs-模版使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-ejs-模版使用"}},[e._v("#")]),e._v(" 11.ejs 模版使用")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("npm i koa-views ejs --save\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// app.use(view(__dirname,{extension: 'ejs'}))\n// 方法一  这样配的模板名是html\napp.use(views('page', { map: { html: 'ejs' } }));\n// 方法二  可以指定后缀名\napp.use(views('page',{\n    extension: 'html'\n}))\n\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("await ctx.render('index');\n")])])]),a("h6",{attrs:{id:"渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染"}},[e._v("#")]),e._v(" 渲染")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("router.get('/', async (ctx, next) => {\n    // 使用ejs数据\n    await ctx.render('news', {\n        title: 'Hello ejs!!!'\n    });\n})\n")])])]),a("h6",{attrs:{id:"ejs使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ejs使用"}},[e._v("#")]),e._v(" ejs使用")]),e._v(" "),a("ol",[a("li",[e._v("循环数据")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<ul>\n    <%for(var i=0; i<lists.length; i++){%>\n        <li><%=lists[i]%></li>\n    <%}%>\n</ul>\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("判断语句")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<%if(number === 10) {%>  \n    <div>是10</div>  \n<%}else{%>\n    <div>不是10</div>\n<%}%>\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("引入模板")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<%- include header.ejs %>\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("绑定数据")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<%=h%>\n")])])]),a("h6",{attrs:{id:"公共数据-所有路由的数据都可以使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公共数据-所有路由的数据都可以使用"}},[e._v("#")]),e._v(" 公共数据(所有路由的数据都可以使用)")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("app.use(async (ctx, next)=>{\n    ctx.state = {\n        name: '王五'\n    }\n    await next();\n})\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);