(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{232:function(e,a,s){"use strict";s.r(a);var t=s(28),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"egg-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#egg-js"}},[e._v("#")]),e._v(" Egg.js")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("创建egg的环境")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sudo npm i egg-init -g\n")])])])]),e._v(" "),s("li",[s("p",[e._v("创建文件夹")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mkdir egg-example && cd egg-example\n")])])])]),e._v(" "),s("li",[s("p",[e._v("初始化模板")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("egg-init --type=simple\n")])])]),s("p",[e._v("或")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("npm init egg --type=simple\n")])])])]),e._v(" "),s("li",[s("p",[e._v("安装依赖")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("npm install\n")])])])]),e._v(" "),s("li",[s("p",[e._v("启动")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("npm run dev\n")])])])]),e._v(" "),s("li",[s("p",[e._v("创建路由")]),e._v(" "),s("ul",[s("li",[e._v("建议分开router 创建routers文件夹，将路由文件放入放到特定文件")]),e._v(" "),s("li",[e._v("编写路由 如：home.js"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("'use strict';\n\n/**\n * @param {Egg.Application} app - egg application\n */\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.get('/hot', controller.home.findHot);\n  router.get('/heart', controller.home.findHeart);\n};\n")])])])]),e._v(" "),s("li",[e._v("引用路由加使用 如：router.js"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("'use strict';\n\nvar homeRouter = require('./routers/home.js');\n\n/**\n * @param {Egg.Application} app - egg application\n */\nmodule.exports = app => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n  homeRouter(app);\n};\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("创建Service")]),e._v(" "),s("ul",[s("li",[e._v("创建service文件夹")]),e._v(" "),s("li",[e._v("创建单个的service文件")]),e._v(" "),s("li",[e._v("引入文件"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("const Service = require('egg').Service;\n")])])])]),e._v(" "),s("li",[e._v("添加service方法+导出"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("class HomeService extends Service {\n    async findHot() {\n        const lists = [\n            {\n                name: '张三',\n                age: 20,\n                address: '南京'\n            }\n        ]\n\n        return lists;\n    }\n}\n\nmodule.exports = HomeService;\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("创建Controller")]),e._v(" "),s("ul",[s("li",[e._v("创建controller文件")]),e._v(" "),s("li",[e._v("引入service使用"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("'use strict';\n\nconst Controller = require('egg').Controller;\n\nclass HomeController extends Controller {\n  async findHot() {\n    this.ctx.body = await this.service.home.findHot();\n  }\n}\n\nmodule.exports = HomeController;\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("格式化参数中间件")]),e._v(" "),s("ul",[s("li",[e._v("创建 params 文件"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("/**\n * 获取请求参数中间件\n * 可以使用ctx.params获取get或post请求参数\n */\n\nmodule.exports = options => {\n    return async function params(ctx, next) {\n        ctx.params = {\n            ...ctx.query,\n            ...ctx.request.body\n        }\n        await next();\n    };\n};\n")])])])]),e._v(" "),s("li",[e._v("在/config/config.default.js里注入中间件"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("'use strict';\nmodule.exports = appInfo => {\n  const config = exports = {};\n// 注入中间件\n  config.middleware = [\n    'params',\n  ];\n  return config;\n};\n")])])])]),e._v(" "),s("li",[e._v("使用"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("async findOne() {\n    const {\n        ctx\n    } = this;\n    let {\n        id\n    } = ctx.params;\n    return {\n        message: '获取单个用户' + id,\n        code: 200\n    }\n}\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("post 不能访问的问题")]),e._v(" "),s("p",[e._v("打开config.default.js 中禁用 csrf")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("const config = exports = {\n    security: {\n      csrf: {\n        enable: false,\n      },\n    }\n};\n")])])])]),e._v(" "),s("li",[s("p",[e._v("连接数据库")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("npm i egg-mongoose --save\n")])])]),s("ul",[s("li",[e._v("加载插件app/config/plugin.js"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("'use strict';\nmodule.exports = {\n  // enable plugins \n  mongoose: {\n    enable: true,\n    package: 'egg-mongoose',\n  },\n};\n")])])])]),e._v(" "),s("li",[e._v("配置MongoDB 的连接, 修改app/config/config.default.js"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("config.mongoose = {\n    client: {\n      url: 'mongodb://127.0.0.1/react-native-demo',\n      options: {},\n    },\n};\n")])])])])])]),e._v(" "),s("li",[s("p",[e._v("创建model文件夹")]),e._v(" "),s("ul",[s("li",[e._v("创建model文件")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("'use strict';\nmodule.exports = app => {\n  const mongoose = app.mongoose;\n  const Schema = mongoose.Schema;\n\n  const UserSchema = new Schema({\n    userName: { type: String },\n    password: { type: String },\n  });\n\n  return mongoose.model('User', UserSchema);\n};\n")])])]),s("ul",[s("li",[e._v("在service层使用")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("await this.ctx.model.User.find();\n")])])])]),e._v(" "),s("li",[s("p",[e._v("egg 跨域")]),e._v(" "),s("ul",[s("li",[e._v("安装egg-cors")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("npm i egg-cors -S\n")])])]),s("ul",[s("li",[e._v("在config/plugin.js声明")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("exports.cors = {\n    enable: true,\n    package: 'egg-cors',\n};\n")])])]),s("ul",[s("li",[e._v("在config/config.default.js配置")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("//跨域配置\nconfig.security = {\n    csrf: {\n      enable: false,\n      ignoreJSON: true\n    },\n    domainWhiteList: ['http://www.baidu.com', 'http://localhost:8080'], //配置白名单\n};\n  \nconfig.cors = {\n    // origin: '*', //允许所有跨域访问，注释掉则允许上面 白名单 访问\n    allowMethods: 'GET,HEAD,PUT,POST,DELETE,PATCH'\n};\n")])])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);